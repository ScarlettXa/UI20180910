
<!DOCTYPE html>

<html lang="zh-cmn-Hans">
<head>
    <meta property="qc:admins" content="1051105554536547046375" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="renderer" content="webkit">
<meta http-equiv="Cache-Control" content="no-siteapp" />
<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="keywords" content="会员会员系统">
    <meta name="description" content="会员会员系统">

    <title>结算购物</title>
    <link href="/cdn/mtopt/ui-2.0-min.css" rel="stylesheet" />
    <link href="/Styles/engine.css" rel="stylesheet" />

    <script src="/cdn/mtopt-2.1-min.js"></script>
    <script src="/cdn/mtopt/ui-2.0-min.js"></script>
    <script src="/cdn/jquery-1.11.1.min.js"></script>
    <script src="/cdn/highcharts-4.0.4/js/highcharts.js"></script>
    <script src="/cdn/highcharts-4.0.4/js/highcharts-more.js"></script>
    <script src="/Scripts/engine.js"></script>

    <style type="text/css">
        .ms-info,
        .ms-menu{min-height:700px;}

        .form{border-bottom:1px solid #eee;border-right:1px solid #eee;width:100%;}
        .form td{border-left:1px solid #eee;border-top:1px solid #eee;}
        .form-title{text-align:center;height:32px;line-height:32px;font-weight:bold;}
        .form-item{height:28px;line-height:28px;}
        .form-item td{padding-left:5px;text-align:center;position:relative;}
        .form-item td:first-child{text-align:left;}
        .from-icon{width:80px;height:80px;}

        .info{margin-top:15px;width:100%;border-top:1px dashed #eee;padding-top:10px;}
        .info td {padding-top:18px;}
        .info .td-title{width:200px;text-align:right;padding-right:6px;}
        .info .m-text{height:25px;width:150px;}
        .info .address {list-style:none;margin:0px;padding:0px;}
        .info .address li{margin-top:6px;cursor:pointer;border:1px solid #ddd;height:25px;width:450px;line-height:25px;padding:0px 5px;}
        .info .address .li-choose{border-color:#0088cc;color:#0088cc;}
        .opera{margin-top:15px;width:100%;border-top:1px dashed #eee;padding-top:10px;}
        .opera .td-span{width:130px;font-size:25px;color:#666;}
        .opera span{color:#4ab9f3;}
        .paging{margin-top:8px;}
    </style>
</head>
<body>
    <!--导航栏-->

<div class="mn-navigation">
    <div class="mn-inner">
        <a href="../User/basicinfo.htm">您好，张三(001)</a>
        <ul class="mn-navigation-menu">
                <li><a href="#" onclick="engine.language(4)">English(英文)</a></li>
                            <li><a href="/Mail/collectlists.htm">收件箱(0)</a></li>
            <li><a href="/Mail/message.htm">意见反馈</a></li>
            <li>
                <span class="m-icon m-icon-headphones"></span>
                <label>联系热线：0512-66668888</label>
            </li>
        </ul>
    </div>
</div>
    <!--标题栏-->
    <div class="mn-header">
        <div class="mn-inner">
            <div class="mn-header-logo"></div>
        </div>
    </div>
    <!--菜单栏-->
    <div class="mn-meter">
        <div class="mn-inner">
            <ul class="mn-meter-menu">
                <li class="home"><span class="m-icon m-icon-home"></span><a href="/Home/main">首页</a></li>
                <li class="member"><span class="m-icon m-icon-user"></span><a href="../Member/recmlists.htm">团队</a></li>
                    <li class="center"><span class="m-icon m-icon-star"></span><a href="../Center/register.htm">代理</a></li>
                <li class="product"><span class="m-icon m-icon-shopping-cart"></span><a href="../Product/main">购物</a></li>
                <li class="deal"><span class="m-icon m-icon-list-alt"></span><a href="/Deal/main.htm">奖金</a></li>
                <li class="mail"><span class="m-icon m-icon-envelope"></span><a href="/Mail/send.htm">邮箱</a></li>
                <li class="notice"><span class="m-icon m-icon-book"></span><a href="../Notice/main">公告</a></li>
                <li class="user"><span class="m-icon m-icon-cog"></span><a href="../User/basicinfo.htm">设置</a></li>
            </ul>
            <a class="mn-meter-cart" href="../User/exit.htm"><span class="m-icon m-icon-off" style="color:#fff;margin-right:8px;"></span><span class="ajaxlangExit"></span></a>
        </div>
    </div>
    <!--内容页-->
    <div class="mn-content">
        <div class="mn-inner">
            
<table cellpadding="0" cellspacing="0" style="width:100%;">
    <tr>
        <td valign="top" style="width:180px;padding-right:12px">

<div class="ms-menu">
    <h3 class="ajaxlangShop"><!--购物--></h3>
    <ul>
        <li class="main"><a href="../Product/main">产品列表</a></li>
        <li class="report"><a href="../Product/report">结算购物</a></li>
        <li class="order"><a href="../Product/order">我的订单</a></li>
        <li class="place"><a href="../Product/place">收货地址</a></li>
    </ul>
</div>

        </td>
        <td valign="top">
            <div class="ms-info">
                <div class="title">结算购物</div>
                <table class="form" cellpadding="0" cellspacing="0">
                    <tr class="form-title">
                        <td style="width:80px;">图片</td>
                        <td>名称</td>
                        <td style="width:120px;">售价</td>
                        <td style="width:90px;">库存</td>
                        <td style="width:90px;">数量</td>
                        <td style="width:120px;">总价</td>
                        <td style="width:50px">操作</td>
                    </tr>
                                            <tr class="form-item form-item-10000002">
                            <td>
                                <a target="_blank" href="../Product/10000002.html">
                                    <img class="from-icon" alt="" src="/service/cms.ashx?key=A53C0ADBCA5CA3ADB26342DFABEF9C&amp;sign=YTRvZTFMZEFkRjR3Slo2TlBKU2ZRQT09&amp;reduce=150" />
                                </a>
                            </td>
                            <td style="text-align:left;">
                                <a target="_blank" href="../Product/10000002.html">PINK瘦身小熊</a>
                                <div style="color:#888;">颜色：默认，尺码：默认</div>
                            </td>
                            <td>
                                <div>售价：<label class="data-price">298.00</label></div>
                                <div>业绩：<label class="data-score">0.00</label></div>
                            </td>
                            <td>998</td>
                            <td>
                                <div class="m-text data-sum" style="width:60px;height:26px;">
                                    <input type="text" class="m-text-ipt" value="2" onchange="pck.setcart(this,100007,100008,10000002)" />
                                </div>
                                <a style="position:absolute;top:19px;right:13px;font-size:15px;font-weight:bold;" onclick="pck.addcart(this,100007,100008,10000002)">+</a>
                                <a style="position:absolute;top:32px;right:11px;font-size:15px;font-weight:bold;" onclick="pck.subcart(this,100007,100008,10000002)">－</a>
                            </td>
                            <td>596.00</td>
                            <td>
                                <a onclick="pck.delcart(this,100007,100008,10000002)">删除</a>
                            </td>
                        </tr>
                </table>
                <table class="info" cellpadding="0" cellspacing="0">
                    <tr>
                        <td class="td-title">支付方式：</td>
                        <td valign="top" style="padding-top:3px;">
                            <table cellpadding="0" cellspacing="0">
                                <tr>
                                    <td><div id="paytype_1" class="m-radio" data-name="paytype"></div></td>
                                    <td>奖金币 (998.00)</td>
                                    <td style="padding-left:20px;"><div id="paytype_2" class="m-radio" data-name="paytype"></div></td>
                                    <td>报单币 (54862.00)</td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr></tr>
                    <tr>
                        <td class="td-title">购买方式：</td>
                        <td valign="top" style="padding-top:3px;">
                            <table cellpadding="0" cellspacing="0">
                                <tr>
                                    <td><div id="buytype_1" class="m-radio" data-name="type"></div></td>
                                    <td>自己购买</td>
                                    <td style="padding-left:20px;"><div id="buytype_2" class="m-radio" data-name="type"></div></td>
                                    <td>会员购买</td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr id="buytype_1_div" style="display:none;">
                        <td class="td-title" valign="top">收货地址：</td>
                        <td>
                            <a href="../Product/placeadd">新增收货地址</a>
                            <ul class="address">
                                    <li onclick="pck.setAddress(this,10000005)">中国北京市朝阳区 西八里店 张三 收 188548582444</li>
                            </ul>
                        </td>
                    </tr>
                    <tr id="buytype_2_div" style="display:none;">
                        <td class="td-title" valign="top">对方编号：</td>
                        <td>
                            <div id="benefitid" class="m-text" data-type="text" data-tip="输入对方编号"></div>
                            <div style="color:#888;">收货地址为默认，无需选择</div>
                        </td>
                    </tr>
                    <tr>
                        <td class="td-title">安全密码：</td>
                        <td>
                            <div id="safeword" class="m-text" data-type="password"></div>
                        </td>
                    </tr>
                    <tr>
                        <td class="td-title">验证码：</td>
                        <td>
                            <div id="checkcode" class="m-text" data-tip="请输入下面字母"></div>
                        </td>
                    </tr>
                    <tr>
                        <td class="td-title"></td>
                        <td>
                            <img id="checkimg" alt="验证码" style="border-color:#eee;cursor:pointer;" />
                        </td>
                    </tr>
                </table>
                <table class="opera" cellpadding="0" cellspacing="0">
                    <tr>
                        <td class="td-span">金额：</td>
                        <td class="td-span" style="width:450px;">
                            <span id="sum_money">0</span>元
                            <label style="font-size:15px;">
                                (已优惠<span id="sum_rebate">0</span>%，业绩：<span id="sum_score">0</span>，运费：<span id="sum_freight">0</span>)
                            </label>
                        </td>
                        <td style="text-align:right;">
                            <a href="../Product/main">返回继续购物</a>
                        </td>
                        <td style="text-align:right;width:160px;">
                            <input id="btn_enter" type="button" class="m-btn m-btn-blue" value="确定选择" onclick="pck.submit()" style="height:35px;width:150px;" />
                        </td>
                    </tr>
                </table>
            </div>
        </td>
    </tr>
</table>
<!--隐藏域开始-->
<input type="hidden" class="HD_MONEY" value="998.00" />
<input type="hidden" class="HD_MONEY_MONEY_REBATE" value="1.00" />
<input type="hidden" class="HD_MONEY_SCORE_REBATE" value="1.00" />
<input type="hidden" class="HD_INSIDE" value="54862.00" />
<input type="hidden" class="HD_INSIDE_MONEY_REBATE" value="1.00" />
<input type="hidden" class="HD_INSIDE_SCORE_REBATE" value="1.00" />
<!--隐藏域结束-->
<script type="text/javascript">
    var pck = {
        isok: false,
        address: 0,
        money: 0,
        inside: 0,
        money_money_rebate: 0,
        money_score_rebate: 0,
        inside_money_rebate: 0,
        inside_score_rebate: 0,
        buytype: 0,
        paytype: 0,
        freight: 0,
        //购物车增加
        addcart: function (elm, color, size, id) {
            var ajax = m.ajax("../Product/api_detail_addcart", null, function (obj) {
                var json = m.parse.toJson(obj);
                if (json.success) {
                    var val = m.node(".form-item-" + id + " .data-sum").plugin("text").value();
                    val = m.parse.toInteger(val) + 1;
                    m.node(".form-item-" + id + " .data-sum").plugin("text").value(val.toString());
                    pck.refresh();
                }
                else { mpi.news(json.message, 3000); }
            });
            ajax.data.add("productid", id);
            ajax.data.add("color", color);
            ajax.data.add("size", size);
            ajax.data.add("sum", 1);
            ajax.send();
        },
        //购物车减少
        subcart: function (elm, color, size, id) {
            var ajax = m.ajax("../Product/api_detail_subcart", null, function (obj) {
                var json = m.parse.toJson(obj);
                if (json.success) {
                    var val = m.node(".form-item-" + id + " .data-sum").plugin("text").value();
                    val = m.parse.toInteger(val) - 1;
                    if (val > 0) {
                        m.node(".form-item-" + id + " .data-sum").plugin("text").value(val.toString());
                    }
                    pck.refresh();
                }
                else { mpi.news(json.message, 3000); }
            });
            ajax.data.add("productid", id);
            ajax.data.add("color", color);
            ajax.data.add("size", size);
            ajax.data.add("sum", 1);
            ajax.send();
        },
        //购物车重设
        setcart: function (elm, color, size, id) {
            var ajax = m.ajax("../Product/api_detail_setcart", null, function (obj) {
                var json = m.parse.toJson(obj);
                if (json.success) {
                    pck.refresh();
                }
                else { mpi.news(json.message, 3000); }
            });
            ajax.data.add("productid", id);
            ajax.data.add("color", color);
            ajax.data.add("size", size);
            ajax.data.add("sum", elm.value);
            ajax.send();
        },
        //购物车删除
        delcart: function (elm, color, size, id) {
            mpi.news("正在处理...", 99999);
            var ajax = m.ajax("../Product/api_detail_delcart", null, function (obj) {
                var json = m.parse.toJson(obj);
                if (json.success) {
                    mpi.news("删除成功", 3000);
                    m.node(elm.parentNode.parentNode).remove(true);
                    setTimeout(function () { pck.refresh(); }, 1000);
                }
                else { mpi.news(json.message, 3000); }
            });
            ajax.data.add("productid", id);
            ajax.data.add("color", color);
            ajax.data.add("size", size);
            ajax.send();
        },
        //设置地址
        setAddress: function (elm, id) {
            m.node(".info .address li").removeClass("li-choose");
            m.node(elm).addClass("li-choose");
            pck.address = id;
            pck.refresh();
        },
        //刷新页面计数
        refresh: function () {
            var sum_money = 0;
            var sum_score = 0;
            m.node(".form-item").find(function (obj) {
                var price = m.parse.toInteger(m.node(".data-price", obj).html());
                var score = m.parse.toInteger(m.node(".data-score", obj).html());
                var sum = m.parse.toInteger(m.node(".data-sum", obj).plugin("text").value());
                //计算
                sum_money += price * sum;
                sum_score += score * sum;
            });
            if (pck.paytype <= 0) {
                m.node("#btn_enter").removeClass("m-btn-blue").click(function () { });
                return;
            }
            else {
                if (pck.paytype == 1) {
                    sum_money = sum_money * this.money_money_rebate;
                    sum_score = sum_score * this.money_score_rebate;
                    m.node("#sum_rebate").html(100 - this.money_money_rebate * 100);
                }
                else {
                    sum_money = sum_money * this.inside_money_rebate;
                    sum_score = sum_score * this.inside_score_rebate;
                    m.node("#sum_rebate").html(100 - this.inside_money_rebate * 100);
                }
                sum_money += pck.freight;
                m.node("#sum_money").html(sum_money);
                m.node("#sum_score").html(sum_score);
                m.node("#sum_freight").html(pck.freight);
                if (pck.paytype == 1 && this.money < sum_money) {
                    m.node("#btn_enter").removeClass("m-btn-blue").click(function () { mpi.news("奖金币不足", 3000) });
                }
                else if (pck.paytype == 2 && this.inside < sum_money) {
                    m.node("#btn_enter").removeClass("m-btn-blue").click(function () { mpi.news("报单币不足", 3000) });
                }
                else {
                    m.node("#btn_enter").addClass("m-btn-blue").click(pck.submit);
                }
            }
            if (pck.isok == true) {
                pck.isok = false;
                m.node("#btn_enter").value("确定选择");
            }
        },
        //结算订单
        submit: function () {
            var safeword = m.node("#safeword").plugin("text").value();
            var benefitid = m.node("#benefitid").plugin("text").value();
            var checkcode = m.node("#checkcode").plugin("text").value();
            //判断数据
            if (pck.paytype <= 0) {
                mpi.news("请选择支付方式", 3000);
                return;
            }
            if (pck.buytype <= 0) {
                mpi.news("请选择购买方式", 3000);
                return;
            }
            else if (pck.buytype == 1) {
                if (pck.address <= 0) {
                    mpi.news("请选择收货地址", 3000);
                    return;
                }
            }
            else {
                if (benefitid.length <= 0) {
                    mpi.news("请输入对方编号", 3000);
                    return;
                }
            }
            if (safeword.length <= 0) {
                mpi.news("请输入安全密码", 3000);
                return;
            }
            if (checkcode.length <= 0) {
                mpi.news("请输入验证码", 3000);
                return;
            }
            if (pck.isok == false) {
                m.node("#btn_enter").value("正在计算运费...");
                var ajax = m.ajax("../Product/api_report_freight", null, function (obj) {
                    pck.freight = parseFloat(m.parse.toJson(obj).Data);
                    setTimeout(function () {
                        pck.refresh();
                        pck.isok = true;
                        m.node("#btn_enter").value("立即提交订单");
                    }, 300);
                });
                ajax.data.add("benefitid", benefitid);
                ajax.data.add("placeid", pck.address);
                ajax.send();
                return;
            }
            //提交购买请求
            mpi.confirm("购买确认", "是否确认提交购买订单 ?", function () {
                var ajax = m.ajax("../Product/api_report_submit", null, function (obj) {
                    var json = m.parse.toJson(obj);
                    if (json.Success) {
                        mpi.news("购买成功正在跳转...", 99999);
                        setTimeout(function () {
                            m.redirect("../Product/order");
                        }, 1000);
                    }
                    else { mpi.news(json.Data, 3000); }
                    m.node("#checkimg").click();
                });
                ajax.data.add("benefitid", benefitid);
                ajax.data.add("paymode", pck.paytype == 1 ? 0 : 1);
                ajax.data.add("safeword", safeword);
                ajax.data.add("checkcode", checkcode);
                ajax.data.add("placeid", pck.address);
                ajax.send();
            });
        },
        init: function () {
            m.node("#checkimg").click(function () {
                var checkcode = m.node("#checkimg");
                var randomstr = m.random.string().capitalAlphabet(16);
                checkcode.attr("src", "/service/check.asmx/getocode?rd=" + randomstr);
            });
            m.node("#checkimg").click();
            this.money_money_rebate = m.parse.toFloat(m.node(".HD_MONEY_MONEY_REBATE").value());
            this.money_score_rebate = m.parse.toFloat(m.node(".HD_MONEY_SCORE_REBATE").value());
            this.inside_money_rebate = m.parse.toFloat(m.node(".HD_INSIDE_MONEY_REBATE").value());
            this.inside_score_rebate = m.parse.toFloat(m.node(".HD_INSIDE_SCORE_REBATE").value());
            this.money = m.parse.toFloat(m.node(".HD_MONEY").value());
            this.inside = m.parse.toFloat(m.node(".HD_INSIDE").value());
        }
    }
    pck.init();
    m.event("ready").add(function () {
        m.node(".ms-menu .report").addClass("choose");
        m.node(".mn-meter-menu .product").addClass("choose");
        pck.refresh(); //刷新计数
        //绑定事件
        m.node("#buytype_1").click(function () {
            m.node("#buytype_2_div").hide();
            m.node("#buytype_1_div").show();
            pck.buytype = 1;
            pck.refresh();
        });
        m.node("#buytype_2").click(function () {
            m.node("#buytype_1_div").hide();
            m.node("#buytype_2_div").show();
            pck.buytype = 2;
            pck.refresh();
        });
        m.node("#paytype_1").click(function () {
            pck.paytype = 1;
            pck.refresh();
        });
        m.node("#paytype_2").click(function () {
            pck.paytype = 2;
            pck.refresh();
        });
    });
</script>
        </div>
    </div>
    <!--客服页-->
    <div class="mn-suspend">
        <dl>
            <dt class="IE6PNG"></dt>
            <dd class="suspendQQ ajaxkefuQQLink"></dd>
            <dd class="suspendTel"><span class="ajaxkefuTel"></span></dd>
        </dl>
    </div>
    <!--底部栏-->

<div class="mn-bottom">
    <div class="mn-inner">
        <div style="clear:both"></div>
        <div style="text-align:center;margin-top:10px;">
            <table cellpadding="2" cellspacing="0" style="width:550px; margin:auto;">
                <tr>
                    <td>Copyright &#169;  2016 Company. All Rights Reserved</td>
                </tr>
            </table>
        </div>
    </div>
</div>
    <input type="hidden" class="HD_SKEY" value="000:44B198BE3FD868E418BBE4CA103AD9" />
    <input type="hidden" class="HD_IPADDRESS" value="222.73.135.181:8009" />
</body>
</html>
